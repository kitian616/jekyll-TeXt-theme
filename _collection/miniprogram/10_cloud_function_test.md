---
title: 学会云函数的本地以及云端的测试
date: 2019-09-12
permalink: /collection/miniprogram/10_cloud_function_test
---

上一篇介绍了云函数的初步使用，对于新手来说，可能有点迷糊，没关系，多创建几个项目试试，慢慢就会熟悉了。

对于云函数的开发，更多的是编写服务端的代码，而服务器又不能完全被我们掌控，所以，出现 BUG 的时候，会有一点刺手。而熟练掌握测试的方法，会较大的提高我们的开发效率。

下面就来介绍云函数的本地测试以及云端测试。

### 本地测试
还是以上一篇创建的云函数 `history` 为例，右键目录，点击「本地调试」。

![](/image/collection/miniprogram/2019-09-12-08-29-39.png)

将会进入一个专门用来调试的界面，如下图：

![](/image/collection/miniprogram/2019-09-12-08-31-16.png)

如果有多个云函数的话，都会显示在左侧边栏上，中间是主要的调试区域，最常用的就是 `console` 标签以及 `Source` 标签。`Console` 就是控制台打印，代码中的打印语句都会显示在这里，也是最常用的调试方法。

![](/image/collection/miniprogram/2019-09-12-08-32-53.png)

`Source` 部分可以进行代码单步调试，对于复杂的逻辑，可以采用这种方法，使用方法与 Chrome 浏览器的调试几乎一致。

![](/image/collection/miniprogram/2019-09-12-08-34-56.png)

最右侧用来触发云函数，也就是模拟调用，支持传入参数。

![](/image/collection/miniprogram/2019-09-12-14-22-55.png)

**注意**：开启本地调试的时候，会检查本地是否安装相应的依赖，如果没有安装的话，需要以命令行的形式，进入该云函数的目录，运行 `npm i` 命令。

这个示例不需要任何的依赖，保持默认，点击调用，控制台得到如下图所示结果：

![](/image/collection/miniprogram/2019-09-12-14-27-22.png)

说明数据返回正常，第三方接口的调用应该没有问题。

### 云端测试
在本地测试没有问题，不代表在云端上也没问题。因为很有可能发生，云函数部署到腾讯云服务器上这个环节出现了问题。例如：代码部署不完整，环境变量错了等等。

下面来看看云端测试如何操作？首先打开云开发界面。

![](/image/collection/miniprogram/2019-09-12-14-32-18.png)

选择云函数，并点击「云端测试」，进行云端调试界面。

![](/image/collection/miniprogram/2019-09-12-14-32-57.png)

云端调试界面相对本地调试，要简单得多了，编辑传入的参数，然后耐心等待结果返回即可。如下图：

![](/image/collection/miniprogram/2019-09-12-14-38-12.png)

一定要耐心等待，因为调用是从云服务器上发起，也许服务器运行很快，但是返回结果到开发工具**很慢很慢**。嗯，写完这句话，结果返回了，如下图：

![](/image/collection/miniprogram/2019-09-12-14-37-32.png)

看到这一堆乱码，恭喜你，证明数据请求成功了，显示成这样，只能说明，开发工具这块还需要优化。

### 总结
这一块的内容非常重要，所以我单独出一篇文章用来讲解，**Debug 是编程最重要的能力，没有之一**。发现问题，能够快速定位到问题所在，这是老手与新手最大的差别，而不是记住了多少 API。

云函数是微信小程序特有的一块功能，它把 Node开发 + 开发工具 + 腾讯云三者结合起来了。其中一块出现问题，都会导致云函数的功能失效，如果出现问题，需要我们一步一步去排查。

下面是我总结的排查顺序，供参考：

1. 本地调试是否成功，成功：Next；不成功：检查本地依赖，检查云函数代码
2. 云端调试是否成功，成功：Next；不成功：检查部署，重新部署等会再试试看
3. 小程序端调用是否成功，成功：Sucess；不成功：检查云函数调用代码
